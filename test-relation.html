<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <svg id="graph"></svg>
    <script src="d3.v6.min.js"></script>
    <script>
        const sets = ["A", "B", "C"]
        const data = [{
                type: "img",
                name: "114237",
                set: ["C"],
            }, {
                type: "img",
                name: "1546",
                set: ["C"],
            }, {
                type: "img",
                name: "112345",
                set: ["C"],
            }, {
                type: "img",
                name: "14123",
                set: ["C"],
            }, {
                type: "img",
                name: "1312",
                set: ["C"],
            },

            {
                type: "img",
                name: "17",
                set: ["A"],
            }, {
                type: "img",
                name: "16",
                set: ["A"],
            }, {
                type: "img",
                name: "15",
                set: ["A"],
            }, {
                type: "img",
                name: "14",
                set: ["A"],
            }, {
                type: "img",
                name: "13",
                set: ["A"],
            }, {
                type: "img",
                name: "12",
                set: ["A"],
            }, {
                type: "img",
                name: "11",
                set: ["A"],
            }, {
                type: "img",
                name: "10",
                set: ["A"],
            }, {
                type: "img",
                name: "177",
                set: ["B"],
            }, {
                type: "img",
                name: "166",
                set: ["B"],
            }, {
                type: "img",
                name: "155",
                set: ["B"],
            }, {
                type: "img",
                name: "144",
                set: ["B"],
            }, {
                type: "txt",
                name: "133",
                set: ["B"],
            }, {
                type: "txt",
                name: "122",
                set: ["B"],
            }, {
                type: "txt",
                name: "111",
                set: ["B"],
            }, {
                type: "txt",
                name: "100",
                set: ["B"],
            }, {
                type: "txt",
                name: "017",
                set: ["A", "B"],
            }, {
                type: "txt",
                name: "116",
                set: ["A", "B"],
            }, {
                type: "txt",
                name: "215",
                set: ["A", "B"],
            }, {
                type: "txt",
                name: "413",
                set: ["A", "B"],
            }, {
                type: "txt",
                name: "512",
                set: ["A", "B"],
            }, {
                type: "txt",
                name: "611",
                set: ["A", "B"],
            }, {
                type: "txt",
                name: "710",
                set: ["A", "B"],
            },
        ]
        console.log(data)

        const text = [
            "Lorem ipsum",
            "Ratione officia",
            "Ipsa nobis",
            "Iure nam",
            "Est recusandae",
            "Fuga debitis",
            "Tempora ipsam",
            "Totam recusandae",
            "Saepe, quae nemo?",
            "Esse consequuntur."
        ]
        const img = [
            "http://communecter74-dev/upload/communecter/organizations/5d41655240bb4e913e0e4a8d/medium/PRCELLE-COLL.png",
            "http://communecter74-dev/upload/communecter/organizations/5d41655b40bb4e913e0e4b5a/medium/index.png",
            "http://communecter74-dev/upload/communecter/organizations/5bfedbee40bb4e91266ea81c/medium/logoefl.png",
        ]

        function randArray(array) {
            return array[Math.floor(Math.random() * (array.length - 1))];
        }
        var links = []
        for (let i = 0; i < data.length; i++) {
            const el = data[i];
            for (const set of el.set) {
                const source = set;
                const target = el.name
                links.push({
                    source,
                    target
                })
            }
        }
        const width = 800,
            height = width;
        const svg = d3.select("svg#graph")
            .attr("height", height)
            .attr("width", width)
            .attr("viewBox", [-width / 2, -height / 2, width, height])
            .append("g")
        for (const name of sets) {
            data.push({
                name,
                type: "group"
            })

        }
        var zoom = d3.zoom().on("zoom", (e) => {
            svg.attr("transform", e.transform)
        });
        var color = d3.scaleOrdinal(['#F9C1C8', '#DCEEC2', '#FBE5C1', '#B6C5F0', '#CCEFFC']);
        d3.select("svg#graph").call(zoom)
        var simulation = d3.forceSimulation(data)
            .force("link", d3.forceLink(links).id(d => d.name).distance(200).strength(1))
            // .force("center", d3.forceCenter().x(width * .5).y(height * .5))
            .force("charge", d3.forceManyBody().strength(-1000))
            .force("x", d3.forceX())
            .force("collide", d3.forceCollide().radius(70).iterations(2))
            .force("y", d3.forceY());

        const link = svg.append("g")
            .attr("stroke", "#999")
            .attr("stroke-width", 1.5)
            .attr("stroke-opacity", 0.4)
            .selectAll("line")
            .data(links)
            .join("line")

        const node = svg
            .selectAll("svg")
            .data(data)
            .join("svg")
            .style("overflow", "visible")



        const group = node.filter(d => d.type && d.type == "group")
        const leaf = node.filter(d => !d.type || d.type != "group")

        group.append("circle")
            .attr("r", 70)
            .attr("fill", "#46a");

        leaf.append("circle")
            .attr("r", 50)
            .attr("fill", (d, i) => color(i));
        leaf.filter(d => d.type == "txt")
            .append("text")
            .attr("text-anchor", "middle")
            .text(d => randArray(text))
        node.append("title")
            .text(d => d.name);

        leaf.on('mouseover', function(e, data, i) {
            leaf.attr('opacity', '.50');
            group.attr('opacity', '.50');
            link
                .attr("stroke-opacity", 0.1)
            const activeLink = link
                .filter(e => e.target.name == data.name)
                .attr("stroke-opacity", 1)
                .attr("stroke-width", 3)
                .attr("id", "active-link")
            activeLink.each(d => {
                group.filter(d => data.set.includes(d.name))
                    .attr('opacity', '1');
            })
            d3.select(this)
                .attr('opacity', '1');
        });
        leaf.on('mouseout', function(d, i) {
            leaf.attr('opacity', '1');
            group.attr('opacity', '1');

            link
                .attr("stroke-opacity", 0.4)
                .attr("stroke-width", 1.5)
                .classed("active", false)
        });

        simulation.on("tick", () => {
            link
                .attr("x1", d => d.source.x)
                .attr("y1", d => d.source.y)
                .attr("x2", d => d.target.x)
                .attr("y2", d => d.target.y);

            node
                .attr("x", d => d.x)
                .attr("y", d => d.y);
        });
    </script>
</body>

</html>